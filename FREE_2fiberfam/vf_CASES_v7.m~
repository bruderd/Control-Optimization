%% Version 7: Has states T_gama and T_betta. Updated the last force balance equation (2/28/2017)

function [f, dfdx, dfdu, df_ddxdt] = vf_CASES_v7(x, u, dxdt, params)

    n = params.n;
    m = params.m;
    
    cases = params.case;
    
    [c1, c2, c3] = deal(params.Felast_consts(1), params.Felast_consts(2), params.Felast_consts(3));
    [c4, c5, c6] = deal(params.Melast_consts(1), params.Melast_consts(2), params.Melast_consts(3));
    
    
    % With phi state, and T_gama and T_betta states
    [P0, gama0, betta0, r0, L0, phi0, T_gama0, T_betta0] = deal(params.x_rest(1), params.x_rest(2), params.x_rest(3), params.x_rest(4), params.x_rest(5), params.x_rest(6), params.x_rest(7), params.x_rest(8));
    [P, gama, betta, r, L, phi, T_gama, T_betta] = deal(x(1), x(2), x(3), x(4), x(5), x(6), x(7), x(8));
    [dP, dgama, dbetta, dr, dL, dphi, dT_gama, dT_betta] = deal(dxdt(1), dxdt(2), dxdt(3), dxdt(4), dxdt(5), dxdt(6), dxdt(7), dxdt(8));
    
    
dfdu = [0.5;...
    0;...
    0;...
    0;...
    0;...
    0;...
    0;...
    0];

if cases == 1
    
    f = [-dP + 0.5*(u - P);...
        2*sin(betta)*T_betta*dbetta - 2*cos(gama)*dT_gama - c1*dL - 2*cos(betta)*dT_betta + 2*sin(gama)*T_gama*dgama + pi*r^2*dP + 2*pi*P*r*dr;...
        2*(sin(betta)*T_betta + sin(gama)*T_gama)*dr + 2*r*(sin(betta)*dT_betta + sin(gama)*dT_gama + cos(betta)*T_betta*dbetta + cos(gama)*T_gama*dgama) - c4*dphi;...
        dL/cos(gama) + ((phi - (L0*tan(gama0))/r0)*dr)/sin(gama) + (r*dphi)/sin(gama) + (sin(gama)*L*dgama)/cos(gama)^2 - (cos(gama)*r*(phi - (L0*tan(gama0))/r0)*dgama)/sin(gama)^2;...
        dL/cos(betta) + ((phi - (L0*tan(betta0))/r0)*dr)/sin(betta) + (r*dphi)/sin(betta) + (sin(betta)*L*dbetta)/cos(betta)^2 - (cos(betta)*r*(phi - (L0*tan(betta0))/r0)*dbetta)/sin(betta)^2;...
        (tan(gama)*L*dr)/r^2 - (tan(gama)*dL)/r - (L*(tan(gama)^2 + 1)*dgama)/r - dphi;...
        (tan(betta)*L*dr)/r^2 - (tan(betta)*dL)/r - (L*(tan(betta)^2 + 1)*dbetta)/r - dphi;...
        2*pi*r^2*dP - sin(betta)*tan(betta)*dT_betta - sin(gama)*tan(gama)*dT_gama + 4*pi*P*r*dr - sin(betta)*T_betta*(tan(betta)^2 + 1)*dbetta - sin(gama)*T_gama*(tan(gama)^2 + 1)*dgama - cos(betta)*tan(betta)*T_betta*dbetta - cos(gama)*tan(gama)*T_gama*dgama];
    
    dfdx = [      -1/2,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                    0,                                                                                                    0,                                                   0,                                                  0,                                    0,                                       0;...
        2*pi*dr*r,                                                                                                                                                                                                                                                    2*dT_gama*sin(gama) + 2*T_gama*dgama*cos(gama),                                                                                                                                                                                                                                                                  2*dT_betta*sin(betta) + 2*T_betta*dbetta*cos(betta),                                                                                2*pi*P*dr + 2*pi*dP*r,                                                   0,                                                  0,                    2*dgama*sin(gama),                     2*dbetta*sin(betta);...
        0,                                                                                                                                                                                                                          2*r*(dT_gama*cos(gama) - T_gama*dgama*sin(gama)) + 2*T_gama*dr*cos(gama),                                                                                                                                                                                                                                      2*r*(dT_betta*cos(betta) - T_betta*dbetta*sin(betta)) + 2*T_betta*dr*cos(betta), 2*dT_betta*sin(betta) + 2*dT_gama*sin(gama) + 2*T_betta*dbetta*cos(betta) + 2*T_gama*dgama*cos(gama),                                                   0,                                                  0, 2*dr*sin(gama) + 2*dgama*r*cos(gama), 2*dr*sin(betta) + 2*dbetta*r*cos(betta);...
        0, (L*dgama)/cos(gama) + (dL*sin(gama))/cos(gama)^2 - (dphi*r*cos(gama))/sin(gama)^2 + (2*L*dgama*sin(gama)^2)/cos(gama)^3 + (dgama*r*(phi - (L0*tan(gama0))/r0))/sin(gama) - (dr*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2 + (2*dgama*r*cos(gama)^2*(phi - (L0*tan(gama0))/r0))/sin(gama)^3,                                                                                                                                                                                                                                                                                                                    0,                            dphi/sin(gama) - (dgama*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                       (dgama*sin(gama))/cos(gama)^2,     dr/sin(gama) - (dgama*r*cos(gama))/sin(gama)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0, (L*dbetta)/cos(betta) + (dL*sin(betta))/cos(betta)^2 - (dphi*r*cos(betta))/sin(betta)^2 + (2*L*dbetta*sin(betta)^2)/cos(betta)^3 + (dbetta*r*(phi - (L0*tan(betta0))/r0))/sin(betta) - (dr*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2 + (2*dbetta*r*cos(betta)^2*(phi - (L0*tan(betta0))/r0))/sin(betta)^3,                       dphi/sin(betta) - (dbetta*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,                    (dbetta*sin(betta))/cos(betta)^2, dr/sin(betta) - (dbetta*r*cos(betta))/sin(betta)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                               (L*dr*(tan(gama)^2 + 1))/r^2 - (dL*(tan(gama)^2 + 1))/r - (2*L*dgama*tan(gama)*(tan(gama)^2 + 1))/r,                                                                                                                                                                                                                                                                                                                    0,                        (dL*tan(gama))/r^2 + (L*dgama*(tan(gama)^2 + 1))/r^2 - (2*L*dr*tan(gama))/r^3,    (dr*tan(gama))/r^2 - (dgama*(tan(gama)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                             (L*dr*(tan(betta)^2 + 1))/r^2 - (dL*(tan(betta)^2 + 1))/r - (2*L*dbetta*tan(betta)*(tan(betta)^2 + 1))/r,                    (dL*tan(betta))/r^2 + (L*dbetta*(tan(betta)^2 + 1))/r^2 - (2*L*dr*tan(betta))/r^3, (dr*tan(betta))/r^2 - (dbetta*(tan(betta)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        4*pi*dr*r, T_gama*dgama*sin(gama)*tan(gama) - dT_gama*cos(gama)*tan(gama) - 2*T_gama*dgama*cos(gama)*(tan(gama)^2 + 1) - dT_gama*sin(gama)*(tan(gama)^2 + 1) - 2*T_gama*dgama*sin(gama)*tan(gama)*(tan(gama)^2 + 1), T_betta*dbetta*sin(betta)*tan(betta) - dT_betta*cos(betta)*tan(betta) - 2*T_betta*dbetta*cos(betta)*(tan(betta)^2 + 1) - dT_betta*sin(betta)*(tan(betta)^2 + 1) - 2*T_betta*dbetta*sin(betta)*tan(betta)*(tan(betta)^2 + 1), 4*pi*P*dr + 4*pi*dP*r, 0, 0, - dgama*sin(gama)*(tan(gama)^2 + 1) - dgama*cos(gama)*tan(gama), - dbetta*sin(betta)*(tan(betta)^2 + 1) - dbetta*cos(betta)*tan(betta)];
    
    df_ddxdt = [     -1,                                                                                0,                                                                                     0,                                         0,             0,            0,             0,              0;...
        pi*r^2,                                                               2*T_gama*sin(gama),                                                                  2*T_betta*sin(betta),                                  2*pi*P*r,           -c1,            0,  -2*cos(gama),  -2*cos(betta);...
        0,                                                             2*T_gama*r*cos(gama),                                                                2*T_betta*r*cos(betta), 2*T_betta*sin(betta) + 2*T_gama*sin(gama),             0,          -c4, 2*r*sin(gama), 2*r*sin(betta);...
        0, (L*sin(gama))/cos(gama)^2 - (r*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                                                                                     0,      (phi - (L0*tan(gama0))/r0)/sin(gama),   1/cos(gama),  r/sin(gama),             0,              0;...
        0,                                                                                0, (L*sin(betta))/cos(betta)^2 - (r*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,    (phi - (L0*tan(betta0))/r0)/sin(betta),  1/cos(betta), r/sin(betta),             0,              0;...
        0,                                                         -(L*(tan(gama)^2 + 1))/r,                                                                                     0,                         (L*tan(gama))/r^2,  -tan(gama)/r,           -1,             0,              0;...
        0,                                                                                0,                                                             -(L*(tan(betta)^2 + 1))/r,                        (L*tan(betta))/r^2, -tan(betta)/r,           -1,             0,              0;...
        2*pi*r^2, - T_gama*sin(gama)*(tan(gama)^2 + 1) - T_gama*cos(gama)*tan(gama), - T_betta*sin(betta)*(tan(betta)^2 + 1) - T_betta*cos(betta)*tan(betta), 4*pi*P*r, 0, 0, -sin(gama)*tan(gama), -sin(betta)*tan(betta)];
    
    
elseif cases == 2
    
    f = [-dP + 0.5*(u - P);...
        2*sin(betta)*T_betta*dbetta - 2*cos(gama)*dT_gama - c1*dL - 2*cos(betta)*dT_betta + 2*sin(gama)*T_gama*dgama + pi*r^2*dP + 2*pi*P*r*dr;...
        2*(sin(betta)*T_betta + sin(gama)*T_gama)*dr + 2*r*(sin(betta)*dT_betta + sin(gama)*dT_gama + cos(betta)*T_betta*dbetta + cos(gama)*T_gama*dgama) - c4*dphi;...
        dL/cos(gama) + ((phi - (L0*tan(gama0))/r0)*dr)/sin(gama) + (r*dphi)/sin(gama) + (sin(gama)*L*dgama)/cos(gama)^2 - (cos(gama)*r*(phi - (L0*tan(gama0))/r0)*dgama)/sin(gama)^2;...
        dL/cos(betta) + ((phi - (L0*tan(betta0))/r0)*dr)/sin(betta) + (r*dphi)/sin(betta) + (sin(betta)*L*dbetta)/cos(betta)^2 - (cos(betta)*r*(phi - (L0*tan(betta0))/r0)*dbetta)/sin(betta)^2;...
        (tan(gama)*L*dr)/r^2 - (tan(gama)*dL)/r - (L*(tan(gama)^2 + 1)*dgama)/r - dphi;...
        (tan(betta)*L*dr)/r^2 - (tan(betta)*dL)/r - (L*(tan(betta)^2 + 1)*dbetta)/r - dphi;...
        2*pi*r^2*dP - sin(betta)*tan(betta)*dT_betta - sin(gama)*tan(gama)*dT_gama + 4*pi*P*r*dr - sin(betta)*T_betta*(tan(betta)^2 + 1)*dbetta - sin(gama)*T_gama*(tan(gama)^2 + 1)*dgama - cos(betta)*tan(betta)*T_betta*dbetta - cos(gama)*tan(gama)*T_gama*dgama];

    dfdx = [      -1/2,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                    0,                                                                                                    0,                                                   0,                                                  0,                                    0,                                       0;...
        2*pi*dr*r,                                                                                                                                                                                                                                                    2*dT_gama*sin(gama) + 2*T_gama*dgama*cos(gama),                                                                                                                                                                                                                                                                  2*dT_betta*sin(betta) + 2*T_betta*dbetta*cos(betta),                                                                                2*pi*P*dr + 2*pi*dP*r,                                                   0,                                                  0,                    2*dgama*sin(gama),                     2*dbetta*sin(betta);...
        0,                                                                                                                                                                                                                          2*r*(dT_gama*cos(gama) - T_gama*dgama*sin(gama)) + 2*T_gama*dr*cos(gama),                                                                                                                                                                                                                                      2*r*(dT_betta*cos(betta) - T_betta*dbetta*sin(betta)) + 2*T_betta*dr*cos(betta), 2*dT_betta*sin(betta) + 2*dT_gama*sin(gama) + 2*T_betta*dbetta*cos(betta) + 2*T_gama*dgama*cos(gama),                                                   0,                                                  0, 2*dr*sin(gama) + 2*dgama*r*cos(gama), 2*dr*sin(betta) + 2*dbetta*r*cos(betta);...
        0, (L*dgama)/cos(gama) + (dL*sin(gama))/cos(gama)^2 - (dphi*r*cos(gama))/sin(gama)^2 + (2*L*dgama*sin(gama)^2)/cos(gama)^3 + (dgama*r*(phi - (L0*tan(gama0))/r0))/sin(gama) - (dr*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2 + (2*dgama*r*cos(gama)^2*(phi - (L0*tan(gama0))/r0))/sin(gama)^3,                                                                                                                                                                                                                                                                                                                    0,                            dphi/sin(gama) - (dgama*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                       (dgama*sin(gama))/cos(gama)^2,     dr/sin(gama) - (dgama*r*cos(gama))/sin(gama)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0, (L*dbetta)/cos(betta) + (dL*sin(betta))/cos(betta)^2 - (dphi*r*cos(betta))/sin(betta)^2 + (2*L*dbetta*sin(betta)^2)/cos(betta)^3 + (dbetta*r*(phi - (L0*tan(betta0))/r0))/sin(betta) - (dr*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2 + (2*dbetta*r*cos(betta)^2*(phi - (L0*tan(betta0))/r0))/sin(betta)^3,                       dphi/sin(betta) - (dbetta*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,                    (dbetta*sin(betta))/cos(betta)^2, dr/sin(betta) - (dbetta*r*cos(betta))/sin(betta)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                               (L*dr*(tan(gama)^2 + 1))/r^2 - (dL*(tan(gama)^2 + 1))/r - (2*L*dgama*tan(gama)*(tan(gama)^2 + 1))/r,                                                                                                                                                                                                                                                                                                                    0,                        (dL*tan(gama))/r^2 + (L*dgama*(tan(gama)^2 + 1))/r^2 - (2*L*dr*tan(gama))/r^3,    (dr*tan(gama))/r^2 - (dgama*(tan(gama)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                             (L*dr*(tan(betta)^2 + 1))/r^2 - (dL*(tan(betta)^2 + 1))/r - (2*L*dbetta*tan(betta)*(tan(betta)^2 + 1))/r,                    (dL*tan(betta))/r^2 + (L*dbetta*(tan(betta)^2 + 1))/r^2 - (2*L*dr*tan(betta))/r^3, (dr*tan(betta))/r^2 - (dbetta*(tan(betta)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        4*pi*dr*r, T_gama*dgama*sin(gama)*tan(gama) - dT_gama*cos(gama)*tan(gama) - 2*T_gama*dgama*cos(gama)*(tan(gama)^2 + 1) - dT_gama*sin(gama)*(tan(gama)^2 + 1) - 2*T_gama*dgama*sin(gama)*tan(gama)*(tan(gama)^2 + 1), T_betta*dbetta*sin(betta)*tan(betta) - dT_betta*cos(betta)*tan(betta) - 2*T_betta*dbetta*cos(betta)*(tan(betta)^2 + 1) - dT_betta*sin(betta)*(tan(betta)^2 + 1) - 2*T_betta*dbetta*sin(betta)*tan(betta)*(tan(betta)^2 + 1), 4*pi*P*dr + 4*pi*dP*r, 0, 0, - dgama*sin(gama)*(tan(gama)^2 + 1) - dgama*cos(gama)*tan(gama), - dbetta*sin(betta)*(tan(betta)^2 + 1) - dbetta*cos(betta)*tan(betta)];
    
    df_ddxdt = [     -1,                                                                                0,                                                                                     0,                                         0,             0,            0,             0,              0;...
        pi*r^2,                                                               2*T_gama*sin(gama),                                                                  2*T_betta*sin(betta),                                  2*pi*P*r,           -c1,            0,  -2*cos(gama),  -2*cos(betta);...
        0,                                                             2*T_gama*r*cos(gama),                                                                2*T_betta*r*cos(betta), 2*T_betta*sin(betta) + 2*T_gama*sin(gama),             0,          -c4, 2*r*sin(gama), 2*r*sin(betta);...
        0, (L*sin(gama))/cos(gama)^2 - (r*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                                                                                     0,      (phi - (L0*tan(gama0))/r0)/sin(gama),   1/cos(gama),  r/sin(gama),             0,              0;...
        0,                                                                                0, (L*sin(betta))/cos(betta)^2 - (r*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,    (phi - (L0*tan(betta0))/r0)/sin(betta),  1/cos(betta), r/sin(betta),             0,              0;...
        0,                                                         -(L*(tan(gama)^2 + 1))/r,                                                                                     0,                         (L*tan(gama))/r^2,  -tan(gama)/r,           -1,             0,              0;...
        0,                                                                                0,                                                             -(L*(tan(betta)^2 + 1))/r,                        (L*tan(betta))/r^2, -tan(betta)/r,           -1,             0,              0;...
        2*pi*r^2, - T_gama*sin(gama)*(tan(gama)^2 + 1) - T_gama*cos(gama)*tan(gama), - T_betta*sin(betta)*(tan(betta)^2 + 1) - T_betta*cos(betta)*tan(betta), 4*pi*P*r, 0, 0, -sin(gama)*tan(gama), -sin(betta)*tan(betta)];
    
    
elseif cases == 3
    
    f = [-dP +  0.5*(u - P);...
        2*sin(betta)*T_betta*dbetta - 2*cos(gama)*dT_gama - c1*dL - 2*cos(betta)*dT_betta + 2*sin(gama)*T_gama*dgama + pi*r^2*dP + 2*pi*P*r*dr;...
        2*(sin(betta)*T_betta + sin(gama)*T_gama)*dr + 2*r*(sin(betta)*dT_betta + sin(gama)*dT_gama + cos(betta)*T_betta*dbetta + cos(gama)*T_gama*dgama) - c4*dphi;...
        dL/cos(gama) + ((phi - (L0*tan(gama0))/r0)*dr)/sin(gama) + (r*dphi)/sin(gama) + (sin(gama)*L*dgama)/cos(gama)^2 - (cos(gama)*r*(phi - (L0*tan(gama0))/r0)*dgama)/sin(gama)^2;...
        dL/cos(betta) + ((phi - (L0*tan(betta0))/r0)*dr)/sin(betta) + (r*dphi)/sin(betta) + (sin(betta)*L*dbetta)/cos(betta)^2 - (cos(betta)*r*(phi - (L0*tan(betta0))/r0)*dbetta)/sin(betta)^2;...
        (tan(gama)*L*dr)/r^2 - (tan(gama)*dL)/r - (L*(tan(gama)^2 + 1)*dgama)/r - dphi;...
        (tan(betta)*L*dr)/r^2 - (tan(betta)*dL)/r - (L*(tan(betta)^2 + 1)*dbetta)/r - dphi;...
        2*pi*r^2*dP - sin(betta)*tan(betta)*dT_betta - sin(gama)*tan(gama)*dT_gama + 4*pi*P*r*dr - sin(betta)*T_betta*(tan(betta)^2 + 1)*dbetta - sin(gama)*T_gama*(tan(gama)^2 + 1)*dgama - cos(betta)*tan(betta)*T_betta*dbetta - cos(gama)*tan(gama)*T_gama*dgama];

    dfdx = [-0.5, 0, 0, 0, 0, 0, 0, 0;...
        2*pi*dr*r,                                                                                                                                                                                                                                                    2*dT_gama*sin(gama) + 2*T_gama*dgama*cos(gama),                                                                                                                                                                                                                                                                  2*dT_betta*sin(betta) + 2*T_betta*dbetta*cos(betta),                                                                                2*pi*P*dr + 2*pi*dP*r,                                                0,                                                  0,                    2*dgama*sin(gama),                     2*dbetta*sin(betta);...
        0,                                                                                                                                                                                                                          2*r*(dT_gama*cos(gama) - T_gama*dgama*sin(gama)) + 2*T_gama*dr*cos(gama),                                                                                                                                                                                                                                      2*r*(dT_betta*cos(betta) - T_betta*dbetta*sin(betta)) + 2*T_betta*dr*cos(betta), 2*dT_betta*sin(betta) + 2*dT_gama*sin(gama) + 2*T_betta*dbetta*cos(betta) + 2*T_gama*dgama*cos(gama),                                                0,                                                  0, 2*dr*sin(gama) + 2*dgama*r*cos(gama), 2*dr*sin(betta) + 2*dbetta*r*cos(betta);...
        0, (L*dgama)/cos(gama) + (dL*sin(gama))/cos(gama)^2 - (dphi*r*cos(gama))/sin(gama)^2 + (2*L*dgama*sin(gama)^2)/cos(gama)^3 + (dgama*r*(phi - (L0*tan(gama0))/r0))/sin(gama) - (dr*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2 + (2*dgama*r*cos(gama)^2*(phi - (L0*tan(gama0))/r0))/sin(gama)^3,                                                                                                                                                                                                                                                                                                                    0,                            dphi/sin(gama) - (dgama*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                    (dgama*sin(gama))/cos(gama)^2,     dr/sin(gama) - (dgama*r*cos(gama))/sin(gama)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0, (L*dbetta)/cos(betta) + (dL*sin(betta))/cos(betta)^2 - (dphi*r*cos(betta))/sin(betta)^2 + (2*L*dbetta*sin(betta)^2)/cos(betta)^3 + (dbetta*r*(phi - (L0*tan(betta0))/r0))/sin(betta) - (dr*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2 + (2*dbetta*r*cos(betta)^2*(phi - (L0*tan(betta0))/r0))/sin(betta)^3,                       dphi/sin(betta) - (dbetta*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,                 (dbetta*sin(betta))/cos(betta)^2, dr/sin(betta) - (dbetta*r*cos(betta))/sin(betta)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                               (L*dr*(tan(gama)^2 + 1))/r^2 - (dL*(tan(gama)^2 + 1))/r - (2*L*dgama*tan(gama)*(tan(gama)^2 + 1))/r,                                                                                                                                                                                                                                                                                                                    0,                        (dL*tan(gama))/r^2 + (L*dgama*(tan(gama)^2 + 1))/r^2 - (2*L*dr*tan(gama))/r^3, (dr*tan(gama))/r^2 - (dgama*(tan(gama)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                             (L*dr*(tan(betta)^2 + 1))/r^2 - (dL*(tan(betta)^2 + 1))/r - (2*L*dbetta*tan(betta)*(tan(betta)^2 + 1))/r,                    (dL*tan(betta))/r^2 + (L*dbetta*(tan(betta)^2 + 1))/r^2 - (2*L*dr*tan(betta))/r^3, (dr*tan(betta))/r^2 - (dbetta*(tan(betta)^2 + 1))/r,                                                  0,                                    0,                                       0;...
[ 4*pi*dr*r, T_gama*dgama*sin(gama)*tan(gama) - dT_gama*cos(gama)*tan(gama) - 2*T_gama*dgama*cos(gama)*(tan(gama)^2 + 1) - dT_gama*sin(gama)*(tan(gama)^2 + 1) - 2*T_gama*dgama*sin(gama)*tan(gama)*(tan(gama)^2 + 1), T_betta*dbetta*sin(betta)*tan(betta) - dT_betta*cos(betta)*tan(betta) - 2*T_betta*dbetta*cos(betta)*(tan(betta)^2 + 1) - dT_betta*sin(betta)*(tan(betta)^2 + 1) - 2*T_betta*dbetta*sin(betta)*tan(betta)*(tan(betta)^2 + 1), 4*pi*P*dr + 4*pi*dP*r, 0, 0, - dgama*sin(gama)*(tan(gama)^2 + 1) - dgama*cos(gama)*tan(gama), - dbetta*sin(betta)*(tan(betta)^2 + 1) - dbetta*cos(betta)*tan(betta)]
    
    df_ddxdt = [-1, 0, 0, 0, 0, 0, 0, 0;...
        pi*r^2,                                                               2*T_gama*sin(gama),                                                                  2*T_betta*sin(betta),                                  2*pi*P*r,          -c1,            0,  -2*cos(gama),  -2*cos(betta);...
        0,                                                             2*T_gama*r*cos(gama),                                                                2*T_betta*r*cos(betta), 2*T_betta*sin(betta) + 2*T_gama*sin(gama),            0,          -c4, 2*r*sin(gama), 2*r*sin(betta);...
        0, (L*sin(gama))/cos(gama)^2 - (r*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                                                                                     0,      (phi - (L0*tan(gama0))/r0)/sin(gama),  1/cos(gama),  r/sin(gama),             0,              0;...
        0,                                                                                0, (L*sin(betta))/cos(betta)^2 - (r*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,    (phi - (L0*tan(betta0))/r0)/sin(betta), 1/cos(betta), r/sin(betta),             0,              0;...
        0,                                                         -(L*(tan(gama)^2 + 1))/r,                                                                                     0,                         (L*tan(gama))/r^2, -tan(gama)/r,           -1,             0,              0;...
        0,                                                                                0,                                                             -(L*(tan(betta)^2 + 1))/r,                        (L*tan(betta))/r^2, -tan(betta)/r,           -1,             0,              0;...
        r,                                                                -T_gama*cos(gama),                                                                    T_betta*cos(betta),                                         P,             0,            0,    -sin(gama),     sin(betta)];
       
elseif cases == 4
    
    f = [-dP + 0.5*(u - P);...
        2*sin(betta)*T_betta*dbetta - 2*cos(gama)*dT_gama - c1*dL - 2*cos(betta)*dT_betta + 2*sin(gama)*T_gama*dgama + pi*r^2*dP + 2*pi*P*r*dr;...
        2*(sin(betta)*T_betta + sin(gama)*T_gama)*dr + 2*r*(sin(betta)*dT_betta + sin(gama)*dT_gama + cos(betta)*T_betta*dbetta + cos(gama)*T_gama*dgama) - c4*dphi;...
        dL/cos(gama) + ((phi - (L0*tan(gama0))/r0)*dr)/sin(gama) + (r*dphi)/sin(gama) + (sin(gama)*L*dgama)/cos(gama)^2 - (cos(gama)*r*(phi - (L0*tan(gama0))/r0)*dgama)/sin(gama)^2;...
        dL/cos(betta) + ((phi - (L0*tan(betta0))/r0)*dr)/sin(betta) + (r*dphi)/sin(betta) + (sin(betta)*L*dbetta)/cos(betta)^2 - (cos(betta)*r*(phi - (L0*tan(betta0))/r0)*dbetta)/sin(betta)^2;...
        (tan(gama)*L*dr)/r^2 - (tan(gama)*dL)/r - (L*(tan(gama)^2 + 1)*dgama)/r - dphi;...
        (tan(betta)*L*dr)/r^2 - (tan(betta)*dL)/r - (L*(tan(betta)^2 + 1)*dbetta)/r - dphi;...
        2*pi*r^2*dP - sin(betta)*tan(betta)*dT_betta - sin(gama)*tan(gama)*dT_gama + 4*pi*P*r*dr - sin(betta)*T_betta*(tan(betta)^2 + 1)*dbetta - sin(gama)*T_gama*(tan(gama)^2 + 1)*dgama - cos(betta)*tan(betta)*T_betta*dbetta - cos(gama)*tan(gama)*T_gama*dgama];

    dfdx = [      -1/2,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                                                                                                                                    0,                                                                                                    0,                                                   0,                                                  0,                                    0,                                       0;...
        2*pi*dr*r,                                                                                                                                                                                                                                                    2*dT_gama*sin(gama) + 2*T_gama*dgama*cos(gama),                                                                                                                                                                                                                                                                  2*dT_betta*sin(betta) + 2*T_betta*dbetta*cos(betta),                                                                                2*pi*P*dr + 2*pi*dP*r,                                                   0,                                                  0,                    2*dgama*sin(gama),                     2*dbetta*sin(betta);...
        0,                                                                                                                                                                                                                          2*r*(dT_gama*cos(gama) - T_gama*dgama*sin(gama)) + 2*T_gama*dr*cos(gama),                                                                                                                                                                                                                                      2*r*(dT_betta*cos(betta) - T_betta*dbetta*sin(betta)) + 2*T_betta*dr*cos(betta), 2*dT_betta*sin(betta) + 2*dT_gama*sin(gama) + 2*T_betta*dbetta*cos(betta) + 2*T_gama*dgama*cos(gama),                                                   0,                                                  0, 2*dr*sin(gama) + 2*dgama*r*cos(gama), 2*dr*sin(betta) + 2*dbetta*r*cos(betta);...
        0, (L*dgama)/cos(gama) + (dL*sin(gama))/cos(gama)^2 - (dphi*r*cos(gama))/sin(gama)^2 + (2*L*dgama*sin(gama)^2)/cos(gama)^3 + (dgama*r*(phi - (L0*tan(gama0))/r0))/sin(gama) - (dr*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2 + (2*dgama*r*cos(gama)^2*(phi - (L0*tan(gama0))/r0))/sin(gama)^3,                                                                                                                                                                                                                                                                                                                    0,                            dphi/sin(gama) - (dgama*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                       (dgama*sin(gama))/cos(gama)^2,     dr/sin(gama) - (dgama*r*cos(gama))/sin(gama)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0, (L*dbetta)/cos(betta) + (dL*sin(betta))/cos(betta)^2 - (dphi*r*cos(betta))/sin(betta)^2 + (2*L*dbetta*sin(betta)^2)/cos(betta)^3 + (dbetta*r*(phi - (L0*tan(betta0))/r0))/sin(betta) - (dr*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2 + (2*dbetta*r*cos(betta)^2*(phi - (L0*tan(betta0))/r0))/sin(betta)^3,                       dphi/sin(betta) - (dbetta*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,                    (dbetta*sin(betta))/cos(betta)^2, dr/sin(betta) - (dbetta*r*cos(betta))/sin(betta)^2,                                    0,                                       0;...
        0,                                                                                                                                                                                               (L*dr*(tan(gama)^2 + 1))/r^2 - (dL*(tan(gama)^2 + 1))/r - (2*L*dgama*tan(gama)*(tan(gama)^2 + 1))/r,                                                                                                                                                                                                                                                                                                                    0,                        (dL*tan(gama))/r^2 + (L*dgama*(tan(gama)^2 + 1))/r^2 - (2*L*dr*tan(gama))/r^3,    (dr*tan(gama))/r^2 - (dgama*(tan(gama)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        0,                                                                                                                                                                                                                                                                                                 0,                                                                                                                                                                                                             (L*dr*(tan(betta)^2 + 1))/r^2 - (dL*(tan(betta)^2 + 1))/r - (2*L*dbetta*tan(betta)*(tan(betta)^2 + 1))/r,                    (dL*tan(betta))/r^2 + (L*dbetta*(tan(betta)^2 + 1))/r^2 - (2*L*dr*tan(betta))/r^3, (dr*tan(betta))/r^2 - (dbetta*(tan(betta)^2 + 1))/r,                                                  0,                                    0,                                       0;...
        dr,                                                                                                                                                                                                                                                        dT_gama*cos(gama) - T_gama*dgama*sin(gama),                                                                                                                                                                                                                                                                      T_betta*dbetta*sin(betta) - dT_betta*cos(betta),                                                                                                   dP,                                                   0,                                                  0,                      dgama*cos(gama),                      -dbetta*cos(betta)];
    
    df_ddxdt = [     -1,                                                                                0,                                                                                     0,                                         0,             0,            0,             0,              0;...
        pi*r^2,                                                               2*T_gama*sin(gama),                                                                  2*T_betta*sin(betta),                                  2*pi*P*r,           -c1,            0,  -2*cos(gama),  -2*cos(betta);...
        0,                                                             2*T_gama*r*cos(gama),                                                                2*T_betta*r*cos(betta), 2*T_betta*sin(betta) + 2*T_gama*sin(gama),             0,          -c4, 2*r*sin(gama), 2*r*sin(betta);...
        0, (L*sin(gama))/cos(gama)^2 - (r*cos(gama)*(phi - (L0*tan(gama0))/r0))/sin(gama)^2,                                                                                     0,      (phi - (L0*tan(gama0))/r0)/sin(gama),   1/cos(gama),  r/sin(gama),             0,              0;...
        0,                                                                                0, (L*sin(betta))/cos(betta)^2 - (r*cos(betta)*(phi - (L0*tan(betta0))/r0))/sin(betta)^2,    (phi - (L0*tan(betta0))/r0)/sin(betta),  1/cos(betta), r/sin(betta),             0,              0;...
        0,                                                         -(L*(tan(gama)^2 + 1))/r,                                                                                     0,                         (L*tan(gama))/r^2,  -tan(gama)/r,           -1,             0,              0;...
        0,                                                                                0,                                                             -(L*(tan(betta)^2 + 1))/r,                        (L*tan(betta))/r^2, -tan(betta)/r,           -1,             0,              0;...
        r,                                                                 T_gama*cos(gama),                                                                   -T_betta*cos(betta),                                         P,             0,            0,     sin(gama),    -sin(betta)];
       
end

end



