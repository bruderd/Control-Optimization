function [y1,xf1] = NLinout_NeuralNetworkFunction_v6(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 24-Aug-2018 21:24:19.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 3xTS matrix, input #1
%   xi1 = 3x10 matrix, initial 10 delay states for input #1.
% and returns:
%   y1 = 6xTS matrix, output #1
%   xf1 = 3x10 matrix, final 10 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0;0;0];
x1_step1.gain = [0.20053699350483;0.200544041106296;0.200280392549569];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.13002948733096781;-0.12556351702018026;0.12788787271139249;-0.12709737037651442;0.1097018348356512;0.093099028720310728;-0.33551229993849568;-0.56799865162197483;-0.12459546159586979;0.7082092776756499];
IW1_1 = [-1.6756733424967976 11.060680929717183 0.91660299644445753 -1.951207811433278 10.576659157905821 1.0365386479335317 0.21914304441017524 9.5046545477990172 0.92729184146809362 0.96952354674929009 7.4140819874719597 0.64320338528345278 0.064806259629509422 4.2316722096074493 -0.27149745012115334 -0.22574170901787113 0.36582844477256549 -2.168974316190186 1.4347516481964959 -1.9597072574032237 -1.6430290384194337 1.8516445802913017 -5.8726376641346629 -0.71335549089904682 0.39620190138754718 -3.4445106813804012 0.58597080432079496 -1.0111568501292085 -32.664091639179993 0.71222375918768566;-2.1535586825314517 0.56393531241627726 -22.328339563865562 -1.5245747544749129 0.84880255502191482 -16.470220250875006 -0.11044095355611332 0.62208812141626491 -14.206439090721737 1.5918930680460426 1.1238206201280398 -9.1209631341640076 2.942922034793694 -0.27561930619479669 -5.9462415477403887 3.9040430628872298 2.2084955220288833 2.1756549426650582 -3.5572161883856084 -0.13407698834537468 4.3931024031278163 -1.2514566670426035 -1.1081165407301758 9.4879218079810226 -1.9324209945849518 -4.0289250398513037 29.192818919123017 2.0131239583008025 0.18312204372199803 23.502787123713173;2.8115580312521011 -0.87097695291481902 16.12437279447596 0.92663338799539419 -0.44798197192810385 13.687654993720043 0.18336564057866478 -0.38067764116859393 11.139177376977818 -0.067795508746044009 0.14717863858661209 10.010695359966677 -4.676597603399455 -0.43565398354200002 3.8556591034993901 -3.6113940365485875 -1.388696226096563 1.4441613988222297 3.627779665598398 -0.51260040382331218 -0.63179605870500888 1.3949997408088737 -0.77169635270120596 -7.7483391739430045 -0.32455258622030764 3.1348497610484389 -8.654044461651079 -0.18587778963579682 1.533068053062961 -39.999884433690752;2.2907667259582585 -12.63127868135825 -1.0404451340345402 1.5411955272171403 -10.726579082450987 -0.86994672054372935 0.13119496081224408 -9.6465503888080093 -0.87293677088681354 -1.2366034405590036 -8.4567014963020029 -0.62150164224460369 0.057403955947073301 -3.8729334541376472 0.38635072234841139 -0.15131841040843524 0.52146043458286739 1.9998843283706882 -1.6067120034820663 0.22593878475692666 1.6089237573835178 -0.99853485423848631 5.1379871599751832 1.1201631397344161 -2.6189825524464889 20.477264182856864 -1.8241090578107317 2.5322747433160422 19.713132555552921 0.089800221474477027;20.365666781175957 -1.3941531757226806 -0.21134438690740043 22.546580761261865 0.16246779880709872 0.016973368734099391 24.344201407298236 0.72905686477697529 0.36636455219500835 22.953978696568921 0.7370690515438556 0.15804322035569374 18.959130598137179 0.50044224272218407 -0.54526048979790764 10.558654592816618 -0.5155624207859214 -1.4312431976167139 -1.203526098553986 -1.7024758164338551 -1.9645734137780855 -17.20522020316697 -1.7490516099325506 -1.3774854667637846 -38.152173311836606 -0.18445961119316501 0.024834944359641009 -64.753386326202801 3.5703725665141648 4.963575757213305;-10.406555508728092 49.864745278392959 1.1476906725360807 -4.5999480311340371 39.487481013095831 0.39642415350607807 -0.15740698273555345 28.962412635115793 0.13073476986382671 2.0805996229041086 17.674134326564282 -1.0730364972937381 4.8786089604682461 6.7231366531660051 -1.3665410195311656 5.4337681634127497 -3.0809896020202561 -0.63048701648235439 5.4474107762639239 -14.782113253234114 -0.34173887485716231 3.6319692745817433 -27.11439611116672 1.1018332863101732 0.22388917261104332 -40.360646697808306 1.8215859511103412 -6.5983280680342631 -58.113046522931249 -1.0805126801198786;-0.16639456386898835 -0.56947448693721714 0.12929013764699387 0.67083123233071329 0.4213825580084945 -0.8572122781328877 0.18175540173568902 -0.53369900181111241 -0.0028556903053820089 0.13849604422844045 -0.11067760495824838 -0.19464344928463834 0.32057625455200994 -0.31772748139266355 -0.23605367865848709 -1.2266290178566526 0.15582700408200098 1.216795121235595 -1.1516601854546391 1.1742204757883306 -1.0013976384394065 -4.5384033560387893 3.6210873241809836 2.5525783798778638 -5.5422098071358556 1.1171227862475921 2.6797829945566303 11.905741757618982 -5.1708812039303371 -4.5451126005529954;1.1711167676763279 0.42751624290395385 -1.0438977363011583 -1.0179233404838879 -0.85260055065904994 1.2209051083616493 0.20759918394431023 0.058240402185090759 -0.072240536368824881 -0.13063917587925575 -0.0015774528194732655 0.16359307618734314 -0.29078640777417869 -0.17299457827607584 0.077473771138320449 0.17591895419205247 0.92310288490151593 -0.58399032481413016 0.83284753871327855 0.47498413402556139 -0.65391775580385181 1.7671373243100683 -0.63180943024035663 -1.8816631474759786 1.7268518033926681 0.2693111707698318 -1.9405510240541699 -4.7050253735206864 -0.71872582092443071 5.2243717998833397;-1.7628269337405553 0.59988423679876357 -32.681165451693907 -1.7448842501783619 0.74010518545829329 -28.371081637289024 7.617945798465281e-05 1.9130204009747189 -19.551151273131982 4.0005522490472902 2.9066230660328523 -11.475403349313368 0.026138312216390486 -0.59098162854310099 -4.00116515883881 3.8856757183446784 2.1417534969867993 6.3440958612016063 -2.1647989468901061 -0.72814915719079765 17.13723693446812 -4.1744474054434022 -5.6227087713789929 18.875405336924771 0.25334167155664411 -3.6053673825069437 17.713231995393201 1.5774120854864415 2.2618256120231557 36.650493063596493;0.018206697776795167 1.2948622753268644 -2.2908095083750943 0.068528379367610387 -1.5934275714140358 1.626247927962496 0.37101677073162498 -0.70850241110907008 -0.37568459778488256 0.64856736461633391 -0.59611993346493097 0.30734283896687803 -0.71944674456963931 -0.39562302812889449 0.15630433896929669 -0.7817250491478579 2.5325965845323997 0.45984688586906619 -1.2173031274810318 2.5614889444981248 -0.83726573870278653 -1.6996378883550542 2.5369908202736617 -1.6926468787053774 0.29866210186778069 0.66660318655615114 0.98703225705103237 3.3341759157422257 -6.9717335908044502 1.9373886177682627];

% Layer 2
b2 = [-0.15424162127523858;-0.11694734213296407;-1.7065300164980279;0.006715646570338441;0.083774237468359145;-1.0696427696594828];
LW2_1 = [-8.3796877399281495 0.33859671887213355 0.20597514066691749 -8.5407588333798863 0.19568631533274924 -0.40993802702173093 -0.36504596007812645 -0.12409982600036049 -0.14304647484807942 -0.092893497624789323;4.1838412771446984 -8.0205814425125723 -5.4801794182878094 4.2222054798012909 0.099581200910637518 0.17221678362126069 -0.16873214025565572 0.21103112386836229 2.8071052734617363 0.089296344271721201;2.3469941614715286 0.48121658703270798 0.30064485696218701 2.3782580600118779 0.094481398136816233 0.090945251250276082 -1.4561980005299742 -1.6542375088868786 -0.21848261292776924 1.2933313642123587;2.5165135708507913 0.19795782950576013 0.16390120139831188 2.8160996592198018 -0.039646733393031708 0.28701495773580199 -0.30897772341462154 -0.11163797667507326 -0.031804003174120105 -0.21712944969312184;-0.99518302687963422 3.6964860760939868 2.0220005856311798 -1.1412524163212505 -0.019988950294570866 -0.13041811446532242 -0.12837755204211806 0.38024090649236392 -1.6647159494150674 0.072279533252673417;0.0091541842404261158 -0.51317115053351459 -0.32455778207821462 -0.020843610376681497 -0.012627393467148787 -0.037616371213039353 -0.79377714694070856 -0.87942071855223669 0.18689790495494152 0.7331739189793729];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [6.02925470600584;5.80239714539318;19.5174170890666;7.66459323490276;7.02419411493605;19.1826794012276];
y1_step1.xoffset = [-0.156274843142796;-0.148885540376267;-0.106342153265596;-0.133510159664189;-0.139378367975141;-0.0515426322556757];

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(3,1)];

% Allocate Outputs
y1 = zeros(6,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+9,11)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-[1 2 3 4 5 6 7 8 9 10]-1,11)+1),30,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 10);
xits = finalxts(finalxts<=10);
xts = finalxts(finalxts>10)-10;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
