function [Y,Xf,Af] = nnet_2020_03_29_16_28(X,~,~)
%NNET_2020_03_29_16_28 neural network simulation function.
%
% Auto-generated by MATLAB, 29-Mar-2020 16:28:58.
% 
% [Y] = nnet_2020_03_29_16_28(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 4xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.937993593924228;-1.14424122052183;-1;-1];
x1_step1.gain = [0.349291125226177;0.957944406235611;1;1];
x1_step1.ymin = -1;

% Layer 1
b1 = [2.5893445162534596271;-3.9648371586086503804;-2.2175008908301219179;2.1485054405989281179;4.4078094483575975815;-0.2719297305889817884;-1.8673943503675149991;2.0667940066748853312;-1.6629373379773901842;-1.3687651154026383438;1.5533447238310913452;1.7130672218379621174;1.1739362834354984955;-0.59725875254079874299;-0.18967804956968484231;-0.50240553413723776366;1.6974391012235816589;0.145124553712458082;-2.002700589868163572;-1.086676161534128271;0.064332760823532772476;1.0461766891871160379;-4.0222231480352910182;1.6559577432277041709;-1.9380422848568996663;-3.7869301699603372668;-6.5375458483163102485;-3.255590876871294892;2.5430458548347441017;-4.9373575618006544374];
IW1_1 = [-3.1761366975134976975 2.454245009599591576 1.0220177719246048564 2.5261772696121802539;3.5389720890151514787 3.6928046284797733101 -0.34219268344996200959 -0.53040973007519065519;-1.2824437209616925681 5.7189004495820690011 -3.250868101555782097 -0.075333797053268758415;-2.5394614540880433573 -1.3060928990614859568 -0.6374148532299342973 1.2902420686962225993;-0.60368544618396879908 2.2960596512797546431 4.9689756830250582098 -2.8470172523039924961;4.9213347207472244449 3.8337275203516600897 1.599289506282055795 3.3666735698094862883;0.89321715603496854019 -3.868045613848225539 -2.0260455575648004256 1.9356708869207031043;-2.5832364664414386723 -2.2513810295699223651 4.6994907606222353635 -2.57164107161970934;0.02016043939840670568 -1.739624547478652028 4.2968777683789811661 -2.9095246192726404999;-1.8457658538047576613 0.81364208185023079167 1.0274913126689493303 -3.1933072045833776897;-3.6528103686456789845 -2.1193067742465427905 4.5745287789877489004 -3.3389785074277367194;-1.6683885938604068322 0.924908090634740776 -0.5939310998341937875 -4.5087315126523410669;0.57830014818227981621 3.6330606293821214869 -9.824833188588316446 -1.5782125122247123716;2.9113125638300312303 -1.5041171406216076178 0.94421872426280195612 -1.3262723223671504247;1.6170728240204172987 -3.1545109211173425479 4.6450890424379300825 -2.9738091027676607503;3.5338995476631023251 -2.6156471799893097341 1.462997745046927589 -1.7650153997111879267;1.0791696144329261386 -4.1862546396684559014 0.1399061808348756597 -1.1643183522295579291;-0.67097275705303494053 -1.5791415857927699751 1.2427416165586548935 -0.48392676907954029764;-3.0510627613784366829 3.0962077084594272769 1.6260868059233426486 0.041777915002736733252;1.5646605013293717334 -7.0722323575309067323 3.0061011415767575627 5.445203801576564473;-0.54168161785743329517 -3.7802428998628716528 3.4757292216451287636 1.1959099441810601139;3.0564447398303968839 2.6823848443768110172 0.89339569419763098512 -0.1008573845527588192;-2.4846135570762113431 2.4968031328782367417 3.1432801133220156231 -2.2256466511265950992;-0.2848003290367103757 -2.7058394381708015253 -2.6956379368603387015 2.0638763872357723805;-1.7049747965669106442 -2.0144192956460376109 -2.4042341955348054405 -0.25838580081636491892;-3.1544110277369328266 -3.8193172589300163899 9.3561350307971373752 2.2633414870166124189;-5.4384858713947830111 2.8632722697415435853 -9.743707103261961322 1.5588002738000310554;-3.3298792291495060702 0.75245608627915661071 -3.7776617825741620749 0.11122630888041064312;3.5683987206792560087 -1.4530200365949788033 4.0821058018457350158 1.3666480790103556764;-5.0216446914664798484 2.6031430083826148092 -7.0060584368966392077 0.17175516310177940671];

% Layer 2
b2 = -2.08834480043239612;
LW2_1 = [-0.53800198750537486792 -3.3734443545810046672 0.94583900673168075368 1.4466228643092158279 2.9495565573164839179 0.62800160934487847531 3.1149560939155449546 -3.9217777378821256917 3.4131550511075152698 -4.7789562848658064809 2.9717539806839585736 0.30946361486352064185 -3.9604297939491539537 4.2661140406417565885 -1.4350095499720525449 -2.0552977681135105037 -1.2397567954934134438 3.0651001285388952411 -1.0918068686864668138 0.32460996569747663232 -0.85905099216916136484 -1.3500815521414235576 2.4022369050053593575 -0.92611109737391050789 -1.3841224607025852666 -3.2242370686415124936 2.1959160160768567138 2.8416860071717660041 2.0095249083059583128 -2.3348931085173290079];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = 1;
y1_step1.xoffset = -1;

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
